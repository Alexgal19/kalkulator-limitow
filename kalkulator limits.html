<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Limitu Pracy Tymczasowej 18/36</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <style>
        /* Ultra nowoczesny design */
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #8BC34A;
            --danger-color: #F44336;
            --light-bg: #F5F5F5;
            --dark-bg: #212121;
            --text-color: #212121;
            --font-family: 'Roboto', sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--light-bg);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .btn-group {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn-add {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-add:hover {
            background-color: #388E3C;
        }

        .btn-install {
            background-color: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-install:hover {
            background-color: #689F38;
        }

        .btn-install img {
            max-width: 100%;
            height: auto;
        }

        .limit-selector {
            margin-top: 20px;
            text-align: center;
        }

        .limit-selector select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kalkulator Limitu Pracy Tymczasowej 18/36</h1>
        <div class="btn-group">
            <button class="btn-add" onclick="addPerson()">+ Dodaj Osobę</button>
            <button class="btn-install" onclick="installApp()">
                <img src="icon.png" alt="Ikona aplikacji">
                Zainstaluj aplikację
            </button>
        </div>
        <div class="limit-selector">
            <label for="limitDays">Wybierz limit dni:</label>
            <select id="limitDays" onchange="updateLimit()">
                <option value="548">548 dni</option>
                <option value="540">540 dni</option>
            </select>
        </div>
        <div id="personsContainer"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pl.js"></script>
    <script>
        let LIMIT_IN_DAYS = 548;

        const dateDiffInDays = (date1, date2) => {
            const MS_PER_DAY = 1000 * 60 * 60 * 24;
            const diffTime = Math.abs(date2.getTime() - date1.getTime());
            return Math.floor(diffTime / MS_PER_DAY) + 1;
        };

        function updateLimit() {
            const limitSelector = document.getElementById('limitDays');
            LIMIT_IN_DAYS = parseInt(limitSelector.value, 10);
        }

        function addPerson() {
            const personsContainer = document.getElementById('personsContainer');
            const personSection = document.createElement('div');
            personSection.className = 'person-section';

            personSection.innerHTML = `
                <div class="person-header">
                    <input type="text" class="personFullName" placeholder="Imię i Nazwisko" required>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Data Rozpoczęcia</th>
                            <th>Data Zakończenia</th>
                            <th>Wykorzystane Dni</th>
                            <th style="width: 50px;">Akcja</th>
                        </tr>
                    </thead>
                    <tbody class="contractsTableBody">
                        <tr>
                            <td><input type="text" class="startDate" required></td>
                            <td><input type="text" class="endDate" required></td>
                            <td class="daysUsed">-</td>
                            <td><button class="btn-remove" onclick="removeRow(this)">Usuń</button></td>
                        </tr>
                    </tbody>
                </table>
                <button class="btn-add" onclick="addRow(this)">+ Dodaj Okres</button>
                <button class="btn-calculate" onclick="calculateAllLimits()">OBLICZ WSZYSTKIE LIMITY</button>
                <button class="btn-clear" onclick="clearAll()">Wyczyść wszystko</button>
                <div class="results-section" style="display: none;">
                    <h3>Wyniki Kalkulacji</h3>
                    <div class="resultsContent"></div>
                </div>
            `;

            personsContainer.appendChild(personSection);

            flatpickr(personSection.querySelectorAll('.startDate'), { dateFormat: "Y-m-d", locale: "pl" });
            flatpickr(personSection.querySelectorAll('.endDate'), { dateFormat: "Y-m-d", locale: "pl" });
        }

        function addRow(button) {
            const tableBody = button.closest('.person-section').querySelector('.contractsTableBody');
            const newRow = tableBody.insertRow();
            newRow.innerHTML = `
                <td><input type="text" class="startDate" required></td>
                <td><input type="text" class="endDate" required></td>
                <td class="daysUsed">-</td>
                <td><button class="btn-remove" onclick="removeRow(this)">Usuń</button></td>
            `;
            flatpickr(newRow.querySelector('.startDate'), { dateFormat: "Y-m-d", locale: "pl" });
            flatpickr(newRow.querySelector('.endDate'), { dateFormat: "Y-m-d", locale: "pl" });
        }

        function removeRow(button) {
            button.closest('tr').remove();
        }

        function clearAll() {
            const personsContainer = document.getElementById('personsContainer');
            personsContainer.innerHTML = '';
        }

        function calculateAllLimits() {
            const personsContainer = document.getElementById('personsContainer');
            const personSections = personsContainer.querySelectorAll('.person-section');

            personSections.forEach(personSection => {
                const personFullName = personSection.querySelector('.personFullName').value;
                const tableBody = personSection.querySelector('.contractsTableBody');
                const rows = tableBody.querySelectorAll('tr');
                const resultsContent = personSection.querySelector('.resultsContent');
                const resultsSection = personSection.querySelector('.results-section');

                let totalDaysUsed = 0;

                rows.forEach(row => {
                    const startDateStr = row.querySelector('.startDate')?.value;
                    const endDateStr = row.querySelector('.endDate')?.value;
                    const daysUsedCell = row.querySelector('.daysUsed');

                    if (!startDateStr || !endDateStr) {
                        daysUsedCell.textContent = '-';
                        return;
                    }

                    let startDate = new Date(startDateStr);
                    let endDate = new Date(endDateStr);

                    if (startDate > endDate) {
                        alert(`Błąd danych dla ${personFullName}: Data rozpoczęcia (${startDateStr}) jest późniejsza niż zakończenia (${endDateStr}).`);
                        return;
                    }

                    const days = dateDiffInDays(startDate, endDate);
                    totalDaysUsed += days;
                    daysUsedCell.textContent = `${days} dni`;
                });

                const remainingDays = LIMIT_IN_DAYS - totalDaysUsed;
                let resultHtml = `
                    <div>
                        <h4>${personFullName}</h4>
                        <p>Wykorzystane dni: ${totalDaysUsed}</p>
                        <p>Pozostało dni: ${remainingDays}</p>
                    </div>
                `;

                if (remainingDays < 0) {
                    resultHtml += `<p style="color: var(--danger-color);">Limit przekroczony o ${Math.abs(remainingDays)} dni!</p>`;
                    resultsSection.className = 'results-section result-exceeded';
                } else {
                    resultsSection.className = 'results-section result-ok';
                }

                resultsContent.innerHTML = resultHtml;
                resultsSection.style.display = 'block';
            });
        }

        function installApp() {
            alert('Funkcja instalacji aplikacji jest w trakcie rozwoju. Wkrótce będzie dostępna!');
        }
    </script>
</body>
</html>
